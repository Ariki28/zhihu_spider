{% extends "base.html" %}
{% block script_file %}
     <script src="http://files-10015041.file.myqcloud.com/static/src/js/components/notify.js"></script>
{% endblock %}
{% block mid_content %}
    <div class="uk-width-medium-1-1" xmlns="http://www.w3.org/1999/html">
      <p class="uk-text-large">知乎看图</p>
      <div class="uk-gird" data-uk-grid-margin>
        <ul class="uk-subnav uk-subnav-pill" data-uk-switcher="{connect:'#switcher-content'}">
            <li class="uk-active" aria-expanded="true"><a href="#">问题</a></li>
            <li aria-expanded="false" class=""><a href="#">收藏夹</a></li>
            <li aria-expanded="false" class=""><a href="#">用户</a></li>
        </ul>

        <ul id="switcher-content" class="uk-switcher">

            <li class="uk-active" aria-hidden="false">
                <div class="uk-width-medium-1-1">
                <div class="uk-container uk-container-center" id="question">
                    {% for i in question_data %}
                        {% set index_1 = loop.index %}
                        <div class="uk-grid" data-uk-grid-margin>
                        <div class="uk-width-medium-1-1">
                        <p class="uk-text-large"><a href="{{ i.url }}" target="_blank">{{ i.title }}</a></p>
                        </div>
                        </div>
                        <div class="uk-grid" data-uk-grid-margin>
                        {% for j in i.image %}
                            {% set index_2 = loop.index %}
                        <div class="uk-width-medium-1-5">
                            <img src="{{ j }}">
                        </div>
                        {% endfor %}
                        </div>
                    {% endfor %}
                </div>
                </div>
{#                <ul class="uk-pagination" id="page_0"></ul>#}
            </li>


            <li aria-hidden="true" class="">
                <div class="uk-width-medium-1-1">
                <div class="uk-container uk-container-center" id="collection">
                </div>
                </div>
            </li>

            <li aria-hidden="true" class="">
                <div id="user"></div>
{#                <ul class="uk-pagination" id="page_2"></ul>#}
            </li>
        </ul>
      </div>

    </div>
{% endblock %}
{% block script %}
    <script>
    question_status = 0;
    function update_item(){
        var all_li = $('.uk-subnav-pill')[0].children;
        for(var i =0;i<all_li.length;i++){
            var current_li = all_li[i];
            if(current_li.attributes['class'].value=="uk-active"){
                if(i==0){
                    var current_num = $('#question')[i].children.length/2;
                    if(question_status==0) {
                        UIkit.notify("加载中...", {timeout: 2000});
                        question_status =1;
                        $.ajax({
                            url: '/index/api/get_more?type=' + i + '&start=' + current_num + '&end=' + (current_num + 5),
                            type: "GET",
                            success: function (data) {
                                for (var j = 0; j < data.data.length; j++) {
                                    var c_data = data.data[j];
                                    var new_div = $('<div class="uk-grid" data-uk-grid-margin></div>');
                                    var title_div = $('<div class="uk-width-medium-1-1"></div>').append(
                                            $('<p class="uk-text-large"></p>').append($('<a></a>').attr('href', c_data.url).text(c_data.title))
                                    );
                                    var image_div = $('<div class="uk-grid" data-uk-grid-margin></div>');
                                    for (var z = 0; z < c_data.image.length; z++) {
                                        var next_div = $('<div class="uk-width-medium-1-5"></div>').append($('<img src="' + c_data.image[z] + '">').attr('width', 250).attr('height', 100));
                                        image_div.append(next_div);
                                    }
                                    $('#question').append(title_div);
                                    $('#question').append(image_div);
                                }
                                question_status = 0;
                            },
                            error: function (XMLHttpRequest, textStatus, errorThrown) {
                                question_status = 0;
                                alert('服务器忙，请重试！' + errorThrown);
                            }
                        });
                    }
                }
            }
        }

    }
$(window).scroll( function() {
    var a = $(document).scrollTop();
    var b = $(window).height();
    var c = $(document).height();
    if(c<=a+b){
        update_item();
    }
});

    </script>
{% endblock %}